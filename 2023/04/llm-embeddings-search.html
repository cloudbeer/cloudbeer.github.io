<!DOCTYPE html>
<html lang=" en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ä½¿ç”¨ LLM embeddings è¿›è¡Œæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„æ–°å§¿åŠ¿ | YouBug</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="ä½¿ç”¨ LLM embeddings è¿›è¡Œæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„æ–°å§¿åŠ¿" />
<meta name="author" content="å•¤é…’äº‘" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="å¤§è¯­è¨€æ¨¡å‹å¯ä»¥å°†æ–‡å­—è½¬åŒ–ä¸º embeddings, embeddings æ˜¯ä¸€ä¸ªå‘é‡(æµ®ç‚¹æ•°) æ•°ç»„ã€‚æŠŠå‘é‡æ•°ç»„å­˜åˆ°æ•°æ®åº“ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡æœç´¢æœ€æ¥è¿‘çš„å‘é‡å°±å¯ä»¥å¾—åˆ°æœç´¢ç»“æœäº†ã€‚æœ¬æ–‡è¯•éªŒäº†è¿™ä¸€æ–¹å¼ã€‚" />
<meta property="og:description" content="å¤§è¯­è¨€æ¨¡å‹å¯ä»¥å°†æ–‡å­—è½¬åŒ–ä¸º embeddings, embeddings æ˜¯ä¸€ä¸ªå‘é‡(æµ®ç‚¹æ•°) æ•°ç»„ã€‚æŠŠå‘é‡æ•°ç»„å­˜åˆ°æ•°æ®åº“ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡æœç´¢æœ€æ¥è¿‘çš„å‘é‡å°±å¯ä»¥å¾—åˆ°æœç´¢ç»“æœäº†ã€‚æœ¬æ–‡è¯•éªŒäº†è¿™ä¸€æ–¹å¼ã€‚" />
<link rel="canonical" href="https://youbug.cn/2023/04/llm-embeddings-search.html" />
<meta property="og:url" content="https://youbug.cn/2023/04/llm-embeddings-search.html" />
<meta property="og:site_name" content="YouBug" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-24T04:13:33+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ä½¿ç”¨ LLM embeddings è¿›è¡Œæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„æ–°å§¿åŠ¿" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"å•¤é…’äº‘"},"dateModified":"2023-04-24T04:13:33+00:00","datePublished":"2023-04-24T04:13:33+00:00","description":"å¤§è¯­è¨€æ¨¡å‹å¯ä»¥å°†æ–‡å­—è½¬åŒ–ä¸º embeddings, embeddings æ˜¯ä¸€ä¸ªå‘é‡(æµ®ç‚¹æ•°) æ•°ç»„ã€‚æŠŠå‘é‡æ•°ç»„å­˜åˆ°æ•°æ®åº“ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡æœç´¢æœ€æ¥è¿‘çš„å‘é‡å°±å¯ä»¥å¾—åˆ°æœç´¢ç»“æœäº†ã€‚æœ¬æ–‡è¯•éªŒäº†è¿™ä¸€æ–¹å¼ã€‚","headline":"ä½¿ç”¨ LLM embeddings è¿›è¡Œæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„æ–°å§¿åŠ¿","mainEntityOfPage":{"@type":"WebPage","@id":"https://youbug.cn/2023/04/llm-embeddings-search.html"},"url":"https://youbug.cn/2023/04/llm-embeddings-search.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://youbug.cn/feed.xml" title="YouBug" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-B4DC7SCVXM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-B4DC7SCVXM');
</script><script>
  console.log("You means 'have', YouBug means 'There is a bug'."); 
</script>
<link rel="icon"
  href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ</text></svg>"></head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">â˜ğŸ YouBug </a><nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path
              d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
          </svg>
        </span>
      </label>

      <div class="trigger">

        <a class="page-link" href="/aiml/">AI/ML</a>
        <a class="page-link" href="/container/">å®¹å™¨</a>
        <a class="page-link" href="/devops/">DevOps</a>
        <a class="page-link" href="/observability/">å¯è§‚æµ‹</a>
        <a class="page-link" href="/iac/">IaC</a>
        <a class="page-link" href="/aws/">AWS</a>
        <a class="page-link" href="/data/">æ•°æ®</a>
        <a class="page-link" href="/tucao/">åæ§½</a>

      </div>
    </nav></div>
</header><main class="page-content" aria-label="Content">
    <div class="wrapper">
      <style>
  pre.highlight {
    position: relative;
    padding-top: 20px;
    padding-bottom: 20px
  }

  pre.highlight>button {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 5px 10px;
    opacity: 0;
  }

  pre.highlight:hover>button {
    opacity: 1;
  }

  pre.highlight:hover>button:hover {
    border: solid 1px #666;
    background-color: #111;
    color: #00ff00;
  }

  pre.highlight>button:active,
  pre.highlight>button:focus {
    opacity: 1;
  }
</style>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">ä½¿ç”¨ LLM embeddings è¿›è¡Œæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„æ–°å§¿åŠ¿</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-04-24T04:13:33+00:00" itemprop="datePublished">2023-04-24
      </time>â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card"
          itemprop="name">å•¤é…’äº‘</span></span></p><img src="/assets/cover/llm-embeddings-query.jpeg" alt="ä½¿ç”¨ LLM embeddings è¿›è¡Œæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„æ–°å§¿åŠ¿" class="cover" /></header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>å¤§è¯­è¨€æ¨¡å‹å¯ä»¥å°†æ–‡å­—è½¬åŒ–ä¸º embeddings, embeddings æ˜¯ä¸€ä¸ªå‘é‡(æµ®ç‚¹æ•°) æ•°ç»„ã€‚æŠŠå‘é‡æ•°ç»„å­˜åˆ°æ•°æ®åº“ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡æœç´¢æœ€æ¥è¿‘çš„å‘é‡å°±å¯ä»¥å¾—åˆ°æœç´¢ç»“æœäº†ã€‚æœ¬æ–‡è¯•éªŒäº†è¿™ä¸€æ–¹å¼ã€‚</p>

<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>

<p>æœ¬æ–‡çš„è¿‡ç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š</p>

<p><img src="/assets/posts/aiml/llm-vector.png" alt="LLM Vecotor Search" /></p>

<p>æœ¬æ–‡å°†ä»£ç ç‰‡æ®µåˆ†è§£åœ¨äº†å„å°èŠ‚ï¼Œä½ å¦‚æœè¦è¿è¡Œæ­¤æ–‡ç« çš„ä»£ç ï¼Œå¯èƒ½éœ€è¦ä¸€ç‚¹ nodejs çš„çŸ¥è¯†ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥è½¬è·³åˆ°æœ€åä¸€å°èŠ‚çœ‹æ•ˆæœã€‚</p>

<p>è°ƒç”¨æœ¬æ–‡ç« çš„ä»£ç éœ€è¦è®¾ç½®å¦‚ä¸‹è¿™äº›ç¯å¢ƒå˜é‡ï¼š</p>

<ul>
  <li>OPENAI_API_KEY</li>
  <li>AWS_ACCESS_KEY_ID</li>
  <li>AWS_SECRET_ACCESS_KEY</li>
</ul>

<h2 id="å‘é‡è®¡ç®—">å‘é‡è®¡ç®—</h2>

<p>é¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªå¤§è¯­è¨€æ¨¡å‹ï¼Œéœ€è¦å°†æ–‡æœ¬è®¡ç®—å‡ºå‘é‡ï¼Œä½ å¯ä»¥éƒ¨ç½²ä¸€ä¸ªç§æœ‰çš„ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ APIã€‚</p>

<p>ä¸‹é¢çš„å‡½æ•° ä½¿ç”¨äº† OpenAI çš„ API æ¥è·å–å‘é‡å€¼ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">OpenAIEmbeddings</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">langchain/embeddings/openai</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">embeddings</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenAIEmbeddings</span><span class="p">({</span> <span class="na">temperature</span><span class="p">:</span> <span class="mf">0.9</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">toVec</span> <span class="o">=</span>  <span class="k">async</span> <span class="nx">text</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">embeddings</span><span class="p">.</span><span class="nx">embedQuery</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="å‘é‡æ•°æ®åº“">å‘é‡æ•°æ®åº“</h2>

<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®åº“èƒ½æ”¯æŒå‘é‡çš„å­˜å‚¨å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ä¸“é—¨çš„å‘é‡æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ OpenSearchï¼ˆElastic Searchï¼‰ï¼Œä»–çš„ knn æ’ä»¶å³å¯ç”¨æ¥å¹²è¿™ä¸ªã€‚</p>

<p>æˆ‘ä»¬å…ˆå» AWS å¼€é€šä¸€ä¸ª OpenSearchï¼ŒéªŒè¯æ–¹å¼å…ˆä½¿ç”¨ IAM Userï¼Œç¨åæˆ‘ä»¬é€šè¿‡è¯¥ User çš„ AKSK æ¥è®¿é—® OpenSearchã€‚</p>

<p>è¯·æ³¨æ„ï¼šéœ€è¦ä½¿ç”¨ OpenSearch è€Œä¸æ˜¯ OpenSearch Serverlessã€‚ï¼ˆOpenSearch Serverless è¿˜ä¸æ”¯æŒ knn æ’ä»¶ï¼Œ2023-4-24ï¼‰</p>

<h2 id="å»ºç´¢å¼•">å»ºç´¢å¼•</h2>

<p>é¦–å…ˆåˆ›å»ºç´¢å¼•ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">defaultProvider</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@aws-sdk/credential-provider-node</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// V3 SDK.</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Client</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@opensearch-project/opensearch</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">AwsSigv4Signer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@opensearch-project/opensearch/aws</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">({</span>
  <span class="p">...</span><span class="nx">AwsSigv4Signer</span><span class="p">({</span>
    <span class="na">region</span><span class="p">:</span> <span class="dl">'</span><span class="s1">us-east-1</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">service</span><span class="p">:</span> <span class="dl">'</span><span class="s1">es</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">getCredentials</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">credentialsProvider</span> <span class="o">=</span> <span class="nx">defaultProvider</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">credentialsProvider</span><span class="p">();</span>
    <span class="p">},</span>
  <span class="p">}),</span>
  <span class="na">node</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://xxxxxx.us-east-1.es.amazonaws.com</span><span class="dl">"</span>
<span class="p">});</span>


<span class="kd">var</span> <span class="nx">index_name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">doc_embeddings</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">createIndex</span><span class="p">:</span> <span class="k">async</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">indices</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="na">index</span><span class="p">:</span> <span class="nx">index_name</span><span class="p">,</span>
    <span class="na">body</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">settings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">index.knn</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">mappings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">properties</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">content_vec</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">knn_vector</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">dimension</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1536</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hnsw</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">space_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">l2</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">engine</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nmslib</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">parameters</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">ef_construction</span><span class="dl">"</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">m</span><span class="dl">"</span><span class="p">:</span> <span class="mi">24</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">});</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Creating index:</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="p">},</span>

</code></pre></div></div>

<h2 id="æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</h2>

<p>å‚è€ƒä¸‹é¢çš„æ–¹æ³•ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">updateData</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">index</span><span class="p">({</span>
      <span class="nx">id</span><span class="p">,</span>
      <span class="na">index</span><span class="p">:</span> <span class="nx">index_name</span><span class="p">,</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
      <span class="na">refresh</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Adding document:</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
  <span class="p">},</span>
</code></pre></div></div>

<p>ç°åœ¨æˆ‘æƒ³é€šè¿‡ url ç›´æ¥è®© OpenAI å¯¹ç½‘å€è¿›è¡Œæ¦‚æ‹¬ï¼Œå¹¶è®¡ç®—å‡ºå‘é‡å€¼ï¼Œå­˜å…¥æ•°æ®åº“ä¸­ã€‚</p>

<p>è¿™ä¸ªæ˜¯æˆ‘è¦æŠ“çš„ Urlï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">datasets</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">"</span><span class="s2">https://www.pinecone.io/learn/vector-database/</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">https://www.infoq.com/news/2023/04/logic-apps-new-data-mapper/</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">https://aws.amazon.com/cn/blogs/china/large-scale-dynamodb-table-data-cross-account-migration-guide/</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">https://aws.amazon.com/blogs/startups/8-highlights-from-aws-startup-day-miami-you-want-to-experience/</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">https://www.baeldung.com/java-serialization</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">https://www.baeldung.com/mockito-lazy-verification</span><span class="dl">"</span>
<span class="p">];</span>
</code></pre></div></div>

<p>è°ƒç”¨ OpenAIï¼Œè®©ä»–å»å¸®æˆ‘ä»¬æ€»ç»“æ–‡ç« å†…å®¹ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span>  <span class="nx">briefUrl</span> <span class="o">=</span> <span class="k">async</span> <span class="nx">url</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">`Summarize this url in English: </span><span class="p">${</span><span class="nx">url</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">};</span>
</code></pre></div></div>

<p>è¿èµ·æ¥è°ƒç”¨ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">updateDataByUrl</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="o">=&gt;</span><span class="p">{</span>
    <span class="kd">const</span> <span class="nx">brief</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">briefUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">content_vec</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">toVec</span><span class="p">(</span><span class="nx">brief</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">updateData</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">id</span><span class="p">,</span>
        <span class="nx">content_vec</span><span class="p">,</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="nx">brief</span>
    <span class="p">})</span>
<span class="p">};</span>


<span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">datasets</span><span class="p">){</span>
    <span class="nx">updateDataByUrl</span><span class="p">(</span>
        <span class="nx">index</span><span class="p">,</span> 
        <span class="nx">datasets</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
    <span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="æŸ¥è¯¢">æŸ¥è¯¢</h2>

<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çŒè¿›å»äº†å‡ ç¯‡æ–‡ç« ï¼Œè¿™å‡ ç¯‡æ–‡ç« å¤§æ¦‚æ˜¯ï¼š</p>

<pre><code class="language-plain">0: ä»‹ç»å‘é‡æ•°æ®åº“çš„
1: å¾®è½¯ VS çš„ä¸€ä¸ª Data Mapper æ–°åŠŸèƒ½
2: AWS DynamoDB çš„è¿ç§»
3: AWS Miami åˆ›ä¸šæ—¥çš„äº®ç‚¹
4: Java åºåˆ—åŒ–çš„æ–¹æ³•
5: Mockito çš„æ‡’éªŒè¯æ–¹å¼
</code></pre>

<p>ä¸‹é¢æ˜¯æŸ¥è¯¢å‡½æ•°ï¼Œè¿”å›äº† 2 æ¡ç›¸å…³ç»“æœï¼Œæœ€æ¥è¿‘çš„æ•°æ®æ’åœ¨äº†æœ€å‰é¢ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// é€šè¿‡å‘é‡æŸ¥è¯¢</span>
<span class="kd">const</span>  <span class="nx">searchVec</span> <span class="o">=</span> <span class="k">async</span> <span class="nx">vq</span> <span class="o">=&gt;</span><span class="p">{</span>
    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">size</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="na">query</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">knn</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">content_vec</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">vector</span><span class="dl">"</span><span class="p">:</span> <span class="nx">vq</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">k</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
      <span class="na">index</span><span class="p">:</span> <span class="nx">index_name</span><span class="p">,</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">query</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hits</span><span class="p">;</span>
  <span class="p">};</span>

<span class="c1">// å°è£…æˆå…³é”®å­—ï¼Œè¿™é‡Œåˆé—®äº† OpenAI ä¸€ä¸‹ã€‚</span>
<span class="kd">const</span>  <span class="nx">search</span> <span class="o">=</span> <span class="k">async</span> <span class="nx">q</span><span class="o">=&gt;</span><span class="p">{</span>
    <span class="kd">const</span> <span class="nx">qVec</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">toVec</span><span class="p">(</span><span class="nx">q</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">searchVec</span><span class="p">(</span><span class="nx">qVec</span><span class="p">);</span>
  <span class="p">};</span>

</code></pre></div></div>

<p>è°ƒç”¨ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">search</span><span class="p">(</span><span class="dl">"</span><span class="s2">å¾®è½¯</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">hits</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">rec</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">({</span>
            <span class="na">_id</span><span class="p">:</span> <span class="nx">rec</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
            <span class="na">_score</span><span class="p">:</span> <span class="nx">rec</span><span class="p">.</span><span class="nx">_score</span><span class="p">,</span>
            <span class="na">url</span><span class="p">:</span> <span class="nx">rec</span><span class="p">.</span><span class="nx">_source</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
            <span class="na">brief</span><span class="p">:</span> <span class="nx">rec</span><span class="p">.</span><span class="nx">_source</span><span class="p">.</span><span class="nx">brief</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>
</code></pre></div></div>

<p>æˆ‘å­˜å…¥çš„å‘é‡å€¼éƒ½æ˜¯é€šè¿‡è‹±æ–‡è®¡ç®—å‡ºæ¥çš„ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§è¯­ä¹‰ç†è§£æ¥æŸ¥è¯¢äº†ã€‚</p>

<p>ä¸‹é¢åˆ—ä¸¾äº†æŸ¥è¯¢çš„è¯è¯­å’Œå’Œç¬¬ä¸€æ¡ç»“æœã€‚ç»“æœä¸­çš„ brief æ˜¯ä½¿ç”¨ AI å¸®å¿™æ€»ç»“çš„æ–‡ç« å†…å®¹ï¼Œå¹¶ä¸” embeddings å€¼ä¹Ÿæ˜¯é€šè¿‡ä»–è®¡ç®—å‡ºæ¥çš„ã€‚</p>

<p>â€œå¾®è½¯â€ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
  _id: <span class="s1">'1'</span>,
  _score: 0.6547316,
  url: <span class="s1">'https://www.infoq.com/news/2023/04/logic-apps-new-data-mapper/'</span>,
  brief: <span class="s1">'\n'</span> +
    <span class="s1">'\n'</span> +
    <span class="s2">"This article discusses Microsoft's Azure Logic Apps Data Mapper, a new feature that enables developers to easily map data between different sources and applications. The article outlines the various benefits of this tool, such as enabling better data integration and making complex data migrations easier. It also explains how the tool can help organizations migrate to the cloud more quickly and easily."</span>
<span class="o">}</span>
</code></pre></div></div>

<p>â€œäºšé©¬é€Šâ€</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
  _id: <span class="s1">'3'</span>,
  _score: 0.6621346,
  url: <span class="s1">'https://aws.amazon.com/blogs/startups/8-highlights-from-aws-startup-day-miami-you-want-to-experience/'</span>,
  brief: <span class="s1">'\n'</span> +
    <span class="s1">'\n'</span> +
    <span class="s1">'This article summarizes the highlights from AWS Startup Day in Miami. It includes topics such as inspiring stories from entrepreneurs, tips on how to succeed in the startup world, and additional resources for those in the tech industry.'</span>
<span class="o">}</span>
</code></pre></div></div>

<p>â€œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹â€ - æ•°æ®åº“çš„æ—¥è¯­</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
  _id: <span class="s1">'0'</span>,
  _score: 0.6666581,
  url: <span class="s1">'https://www.pinecone.io/learn/vector-database/'</span>,
  brief: <span class="s1">'\n'</span> +
    <span class="s1">'\n'</span> +
    <span class="s1">'This article provides an introduction to vector databases, which are databases that store and process data in vector, rather than the traditional tabular, form. It outlines the advantages of using vector databases, such as faster query performance and more powerful analysis capabilities, and describes the components of a vector database and how they function.'</span>
<span class="o">}</span>
</code></pre></div></div>

<p>â€œå¦‚ä½•è¿ç§»äºšé©¬é€Šäº‘çš„æ•°æ®â€</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
  _id: <span class="s1">'2'</span>,
  _score: 0.69728285,
  url: <span class="s1">'https://aws.amazon.com/cn/blogs/china/large-scale-dynamodb-table-data-cross-account-migration-guide/'</span>,
  brief: <span class="s1">'\n'</span> +
    <span class="s1">'\n'</span> +
    <span class="s1">'This website provides a guide for those wishing to migrate large amounts of data from one DynamoDB table to another, between different AWS accounts. It covers topics such as what data can be migrated, best practices, and step-by-step instructions.'</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æˆ‘è¿˜æµ‹è¯•äº†å‡ ä¸ªï¼Œæ¯”å¦‚ â€œI have no timeâ€ æŸ¥åˆ°äº† æ‡’åŠ è½½ï¼Œâ€æ€ä¹ˆåšç”Ÿæ„â€ æŸ¥è¯¢åˆ°äº† aws åˆ›ä¸šæ—¥ã€‚</p>

<p>ä»æ•´ä¸ªé€»è¾‘å¯ä»¥çœ‹åˆ° <strong>LLM è¯­è¨€æ¨¡å‹çš„èƒ½åŠ›è¶Šå¼ºï¼Œä½ çš„æ•°æ®åº“ç³»ç»Ÿçš„è¯­è¨€ç†è§£èƒ½åŠ›è¶Šå¼º</strong>ï¼Œç„¶åå°±æ˜¯è¦çœ‹æ•°æ®åº“å‘é‡æ£€ç´¢çš„èƒ½åŠ›äº†ï¼Œç°åœ¨å¸‚é¢ä¸Šå·²ç»æœ‰å¾ˆå¤šçš„å‘é‡æ•°æ®åº“äº†ã€‚</p>

<p>åœ¨ AIGC å’Œå¤§æ¨¡å‹çš„å½“ä¸‹ï¼Œè¿˜æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åšï¼å¤§å®¶åŠ æ²¹ï¼</p>

<hr />

<p>å‚è€ƒï¼š</p>

<p><a href="https://docs.langchain.com/">https://docs.langchain.com/</a></p>

<p><a href="https://opensearch.org/docs/latest/search-plugins/knn/knn-index/">https://opensearch.org/docs/latest/search-plugins/knn/knn-index/</a></p>

  </div>

  <a class="u-url" href="/2023/04/llm-embeddings-search.html" hidden></a>
</article>


<script>
  var codeBlocks = document.querySelectorAll('pre.highlight');

  codeBlocks.forEach(function (codeBlock) {
    var copyButton = document.createElement('button');
    copyButton.className = 'copy';
    copyButton.type = 'button';
    copyButton.ariaLabel = 'Copy code to clipboard';
    copyButton.innerText = 'Copy';

    codeBlock.append(copyButton);

    copyButton.addEventListener('click', function () {
      var code = codeBlock.querySelector('code').innerText.trim();
      window.navigator.clipboard.writeText(code);

      copyButton.innerText = 'Copied';
      var fourSeconds = 4000;

      setTimeout(function () {
        copyButton.innerText = 'Copy';
      }, fourSeconds);
    });
  });
</script>
    </div>
  </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>è®¢é˜…æœ¬ç«™</span>
          </a>
        </p>
      </div>


    </div>

    <div class="footer-col-wrapper">

      <div class="footer-col">æ¬¢è¿è®¿é—®: <a href="https://chuchur.com/" target="_blank">ç¦…å¢ƒèŠ±å›­</a></div>
    </div>
  </div>

</footer><div class="bbanner">
    æ¬¢è¿è½¬è½½æ–‡ç« ï¼Œè½¬è½½ä¸ç”¨å’Œæˆ‘è¯´ã€‚
    æœ¬ç«™æ‰€æœ‰ä¿¡æ¯å‡ä»£è¡¨æˆ‘è‡ªå·±ï¼Œä¸ä»£è¡¨ä»»ä½•å…¬å¸ã€‚
  </div>
</body>

<style>
  hr {
    margin: 20px 0;
  }

  .bbanner {
    padding: 20px 0;
    text-align: center;
    color: #999;
    font-size: 12px;
  }
</style>

<script>
  function addChild(top, snowShape) {
    var div = document.createElement("div");
    div.innerHTML = snowShape;
    div.className = "flake";
    div.style.position = 'fixed';
    div.style.color = 'white';
    div.style.opacity = 0.9;
    div.style.left = parseInt(Math.random() * window.innerWidth) + 'px';
    div.style.top = top + 'px';
    div.style.fontSize = parseInt(Math.random() * 50) + 'px';
    document.body.appendChild(div);
  };
  function autoWipe(snowSpeed, snowShape) {
    var flake = document.getElementsByClassName('flake');
    var timer = setInterval(function () {
      for (var i = 0; i < flake.length; i++) {
        var opacity = flake[i].style.opacity;
        var offsetTop = Number((flake[i].style.top).replace('px', ''));
        if (offsetTop < window.innerHeight) {
          offsetTop = offsetTop + snowSpeed;
          opacity = opacity - 0.003;
          flake[i].style.top = offsetTop + 'px';
          flake[i].style.opacity = opacity;
        } else {
          document.body.removeChild(flake[i]);
          addChild(0, snowShape);
        }
      }
    }, 100);
  };
  function final(bigSnowParam, snowShape) {
    for (var i = 0; i < bigSnowParam.snowNum; i++) {
      addChild(parseInt(Math.random() * window.innerHeight), snowShape);
    }
    autoWipe(bigSnowParam.snowSpeed, snowShape);
  };
  //å½¢æˆæœ€åæ•ˆæœ
  function final(bigSnowParam, snowShape) {
    for (var i = 0; i < bigSnowParam.snowNum; i++) {
      addChild(parseInt(Math.random() * window.innerHeight), snowShape);
    }
    autoWipe(bigSnowParam.snowSpeed, snowShape);
  };

  var bigSnowParam = {
    snowNum: 242,
    snowSpeed: 6
  };
  var midSnowParam = {
    snowNum: 242,
    snowSpeed: 3
  };
  var littleSnowParam = {
    snowNum: 50,
    snowSpeed: 2
  };
  //è‡ªå®šä¹‰é›ªå‚è€ƒå€¼
  var selfSnowParam = {
    snowNum: '',//å€¼ä¸ºnumber
    snowSpeed: ''//å€¼ä¸ºnumber
  };

  var snowShapeObj = {
    1: 'â†',
    2: 'â„',
    3: 'â…',
    4: 'âœ¼',
    5: 'âœ¼',
    6: 'â‰',
    7: 'â‡',
    8: 'âˆ',
    9: 'âŠ',
    10: 'âœ¥',
    11: 'âœº'
  };
  // final(littleSnowParam, snowShapeObj[1]);
</script>

</html>